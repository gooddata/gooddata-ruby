language: ruby
cache: bundler
stages:
  - unit
  - name: integration
    if: type = api
jobs:
  include:
    - stage: unit
      script: bundle exec rake test:unit
      rvm:
        - 2.2
        - jruby-9.1.7
    - stage: unit
      script: |
              git remote add upstream https://github.com/gooddata/gooddata-ruby.git
              git fetch upstream master
              if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then
                export PRONTO_PULL_REQUEST_ID="$TRAVIS_PULL_REQUEST"
                bundle exec pronto run -f github_pr -c upstream/master --exit-code
              else
                bundle exec pronto run -c upstream/master --exit-code
              fi
      rvm:
        - 2.2
    - stage: integration
      script: |
              bundle exec rake -f lcm.rake docker:build
              bundle exec rake -f lcm.rake docker:bundle
              bundle exec rake -f lcm.rake test:integration:docker
      rvm:
        - jruby-9.1.7
    - stage: integration
      script: bundle exec rake test:sdk
      rvm: jruby-9.1.7
    - stage: integration
      script: bundle exec rake test:project
      rvm: jruby-9.1.7
